From baf3930596273b5a94ddf2353048fe6a6c481545 Mon Sep 17 00:00:00 2001
From: Walter Bender <walter@sugarlabs.org>
Date: Wed, 23 Oct 2013 15:09:09 -0400
Subject: [PATCH] don't check for maximum activities/instances until after
 re-launch check

---
 src/jarabe/journal/misc.py | 11 ++++++-----
 1 file changed, 6 insertions(+), 5 deletions(-)

diff --git a/src/jarabe/journal/misc.py b/src/jarabe/journal/misc.py
index 086385e..a9acc06 100644
--- a/src/jarabe/journal/misc.py
+++ b/src/jarabe/journal/misc.py
@@ -223,15 +223,10 @@ def resume(metadata, bundle_id=None, force_bundle_downgrade=False):
 def launch(bundle, activity_id=None, object_id=None, uri=None, color=None,
            invited=False):
     shell_model = shell.get_model()
-    if shell_model.reached_maximum_number_of_open_activities():
-        return
 
     if activity_id is None or not activity_id:
         activity_id = activityfactory.create_activity_id()
 
-    if shell_model.reached_maximum_number_of_open_instances(bundle):
-        return
-
     logging.debug('launch bundle_id=%s activity_id=%s object_id=%s uri=%s',
                   bundle.get_bundle_id(), activity_id, object_id, uri)
 
@@ -252,6 +247,12 @@ def launch(bundle, activity_id=None, object_id=None, uri=None, color=None,
         activity.get_window().activate(Gtk.get_current_event_time())
         return
 
+    if shell_model.reached_maximum_number_of_open_activities():
+        return
+
+    if shell_model.reached_maximum_number_of_open_instances(bundle):
+        return
+
     if color is None:
         client = GConf.Client.get_default()
         color = XoColor(client.get_string('/desktop/sugar/user/color'))
-- 
1.8.3.1

